<!--
  WoW Item Browser
  Place this file alongside your items.json generated by Scraper.py
  Note: For `fetch('items.json')` to work, serve this directory via HTTP, e.g.:
    cd /path/to/files && python3 -m http.server
  Then open http://localhost:8000/index.html in your browser
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WoW Item Browser</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #1b1b1b; color: #f0f0f0; }
    h1 { margin-bottom: 20px; }
    select { margin: 5px 0 15px; padding: 5px; font-size: 1rem; }
    .item { display: flex; align-items: center; margin: 10px 0; background: #2b2b2b; padding: 8px; border-radius: 4px; }
    .item img { width: 36px; height: 36px; margin-right: 10px; }
    .item .name { font-weight: bold; }
    /* Quality color mapping */
    .quality-poor { color: #9d9d9d; }
    .quality-common { color: #ffffff; }
    .quality-uncommon { color: #1eff00; }
    .quality-rare { color: #0070dd; }
    .quality-epic { color: #a335ee; }
    .quality-legendary { color: #ff8000; }
  </style>
</head>
<body>
  <h1>WoW Item Browser</h1>
  <label for="armorType">Armor Type:</label><br>
  <select id="armorType">
    <option value="">-- Select Armor Type --</option>
  </select><br>

  <label for="boss">Boss:</label><br>
  <select id="boss" disabled>
    <option value="">-- Select Boss --</option>
  </select>

  <div id="items"></div>

  <script>
    (async function() {
      let data;
      try {
        const res = await fetch('items.json');
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        data = await res.json();
      } catch (err) {
        document.body.innerHTML = 
          `<p style="color: #ff8080;">
             Error loading items.json: ${err.message}.<br>
             Please run a local HTTP server, e.g.:<br>
             <code>python3 -m http.server</code><br>
             and open via <a href="http://localhost:8000/index.html" style="color: #1eff00;">http://localhost:8000/index.html</a>
           </p>`;
        console.error(err);
        return;
      }

      const armorData = data.Armor;
      const armorSelect = document.getElementById('armorType');
      const bossSelect = document.getElementById('boss');
      const itemsDiv = document.getElementById('items');

      // Populate armor type dropdown
      Object.keys(armorData).forEach(type => {
        const opt = document.createElement('option');
        opt.value = type;
        opt.textContent = type;
        armorSelect.appendChild(opt);
      });

      let currentItems = [];

      armorSelect.addEventListener('change', () => {
        const type = armorSelect.value;
        itemsDiv.innerHTML = '';
        bossSelect.innerHTML = '<option value="">-- Select Boss --</option>';
        bossSelect.disabled = true;
        if (!type) return;

        // Get items for selected armor type
        let itemsList = armorData[type];
        if (type === 'Accessories') {
          // Flatten subcategories
          itemsList = Object.values(itemsList).flat();
        }
        currentItems = itemsList || [];

        // Extract unique bosses
        const bosses = [...new Set(currentItems.map(i => i.source.boss).filter(b => b))].sort();
        bosses.forEach(boss => {
          const opt = document.createElement('option');
          opt.value = boss;
          opt.textContent = boss;
          bossSelect.appendChild(opt);
        });
        bossSelect.disabled = bosses.length === 0;
      });

      bossSelect.addEventListener('change', () => {
        const boss = bossSelect.value;
        itemsDiv.innerHTML = '';
        if (!boss) return;
        const filtered = currentItems.filter(i => i.source.boss === boss);
        if (filtered.length === 0) {
          itemsDiv.innerHTML = '<p>No items found for this boss.</p>';
          return;
        }
        filtered.forEach(item => {
          const div = document.createElement('div');
          div.className = 'item';

          const img = document.createElement('img');
          img.src = item.icon;
          img.alt = item.name;
          div.appendChild(img);

          const span = document.createElement('span');
          span.className = 'name quality-' + item.quality;
          span.textContent = item.name;
          div.appendChild(span);

          itemsDiv.appendChild(div);
        });
      });
    })();
  </script>
</body>
</html>
